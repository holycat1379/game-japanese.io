{"version":3,"file":"_id_ copy-_ApnXWkI.js","sources":["../../src/pages/study/[id] copy.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { useMediaControls } from '@vueuse/core'\nimport { ref } from 'vue'\n\nconst route = useRoute()\n\nconst config = {\n  startIndex: 10,\n  endIndex: 18,\n}\nconst lessons = computed(() => {\n  return Array.from({ length: config.endIndex - config.startIndex + 1 }, (_, i) => {\n    return {\n      id: i + config.startIndex,\n      name: `第${i + config.startIndex}课`,\n      mp3: `/japanese/mina-no-nihongo/${i + config.startIndex}.mp3`,\n      vtt: `/japanese/mina-no-nihongo/${i + config.startIndex}.mp3.zh-CN-dual.vtt`,\n    }\n  })\n})\nconst currentLesson = reactive(lessons.value.find(lesson => lesson.id === Number(route.params.id)))\nconst video = ref()\nconst {\n  currentTime,\n  volume,\n  playing,\n  tracks,\n} = useMediaControls(video, {\n  src: currentLesson.mp3,\n  tracks: [\n    {\n      default: true,\n      src: currentLesson.vtt,\n      kind: 'subtitles',\n      label: 'English',\n      srcLang: 'en',\n    },\n  ],\n})\nconst cues = reactive<{ startTime: number, endTime: number, text: string }[]>([])\n// 通过cues获得当前字幕\nconst preCurrentCue = ref([])\n\nconst currentCue = computed(() => {\n  const returnValue = []\n\n  if (tracks.value[0] && tracks.value[0].cues) {\n    const time = currentTime.value\n\n    for (const key in tracks.value[0].cues) {\n      const cue = tracks.value[0].cues[key]\n      if (cue.startTime <= time && cue.endTime >= time)\n        returnValue.push(cue)\n    }\n  }\n\n  if (returnValue.length > 1) {\n    preCurrentCue.value = returnValue\n    return `${returnValue[0].text}\\n${returnValue[1].text}`\n  }\n  else {\n    return `${preCurrentCue.value[0].text}\\n${preCurrentCue.value[1].text}`\n  }\n})\n\nonMounted(() => {\n  volume.value = 0.5\n  currentTime.value = 0\n\n  // cues.push(...tracks.value[0].cues)\n  setTimeout(() => {\n    updateCurrentCue(currentCue.value)\n  }, 2000)\n})\n\nfunction updateCurrentCue(currentCue) {\n  // 获取 iframe 元素\n  const iframe = document.getElementById('myIframe')\n\n  // 如果找到了 iframe 元素\n  if (iframe) {\n    // 获取 iframe 内部的文档对象\n    const iframeDocument = iframe.contentDocument || iframe.contentWindow.document\n\n    // 在 iframe 内部查找元素\n    const target = iframeDocument.getElementById('continue_语句')\n    if (!target) {\n      console.log('未找到指定的元素')\n      return\n    }\n\n    // 给target.nextElementSibling增加一个p元素\n\n    const container = target.nextElementSibling\n\n    container.children[1].innerText = currentCue\n    // 插入到container中第一个元素和第二个元素之间\n  }\n  else {\n    console.log('未找到指定的 iframe 元素')\n  }\n}\n\n// watchEffect(() => {\n//   if (tracks.value[0] || currentTime.value) {\n//     cues = tracks.value[0].cues\n//     updateCurrentCue()\n//   }\n// })\n\nonKeyStroke(' ', (e) => {\n  playing.value = !playing.value\n  if (playing.value)\n    updateCurrentCue(`-\\n-`)\n  else\n    updateCurrentCue(currentCue.value)\n\n  e.preventDefault()\n})\nonKeyStroke('ArrowRight', (e) => {\n  currentTime.value = preCurrentCue.value[0].startTime\n  e.preventDefault()\n})\n</script>\n\n<template>\n  <div>\n    <iframe id=\"myIframe\" src=\"/test-html/循环与迭代 - JavaScript _ MDN.html\" class=\"iframe\" />\n    <video ref=\"video\" />\n    <button v-for=\"lesson in lessons\" :key=\"lesson.name\" @click=\"currentLesson = lesson\">\n      {{ lesson.name }}\\\n    </button>\n  </div>\n</template>\n\n<style scoped>\n.iframe {\n  width: 100vw;\n  height: 100vh;\n}\n</style>\n"],"names":["route","useRoute","config","lessons","computed","_","i","currentLesson","reactive","lesson","video","ref","currentTime","volume","playing","tracks","useMediaControls","preCurrentCue","currentCue","returnValue","time","key","cue","onMounted","updateCurrentCue","iframe","target","container","onKeyStroke"],"mappings":"uWAIA,MAAMA,EAAQC,IAERC,EAAS,CACb,WAAY,GACZ,SAAU,EAAA,EAENC,EAAUC,EAAS,IAChB,MAAM,KAAK,CAAE,OAAQF,EAAO,SAAWA,EAAO,WAAa,CAAE,EAAG,CAACG,EAAGC,KAClE,CACL,GAAIA,EAAIJ,EAAO,WACf,KAAM,IAAII,EAAIJ,EAAO,UAAU,IAC/B,IAAK,6BAA6BI,EAAIJ,EAAO,UAAU,OACvD,IAAK,6BAA6BI,EAAIJ,EAAO,UAAU,qBAAA,EAE1D,CACF,EACKK,EAAgBC,EAASL,EAAQ,MAAM,KAAKM,GAAUA,EAAO,KAAO,OAAOT,EAAM,OAAO,EAAE,CAAC,CAAC,EAC5FU,EAAQC,IACR,CACJ,YAAAC,EACA,OAAAC,EACA,QAAAC,EACA,OAAAC,CAAA,EACEC,EAAiBN,EAAO,CAC1B,IAAKH,EAAc,IACnB,OAAQ,CACN,CACE,QAAS,GACT,IAAKA,EAAc,IACnB,KAAM,YACN,MAAO,UACP,QAAS,IACX,CACF,CAAA,CACD,EACYC,EAAiE,CAAA,CAAE,EAE1E,MAAAS,EAAgBN,EAAI,CAAA,CAAE,EAEtBO,EAAad,EAAS,IAAM,CAChC,MAAMe,EAAc,CAAA,EAEhB,GAAAJ,EAAO,MAAM,CAAC,GAAKA,EAAO,MAAM,CAAC,EAAE,KAAM,CAC3C,MAAMK,EAAOR,EAAY,MAEzB,UAAWS,KAAON,EAAO,MAAM,CAAC,EAAE,KAAM,CACtC,MAAMO,EAAMP,EAAO,MAAM,CAAC,EAAE,KAAKM,CAAG,EAChCC,EAAI,WAAaF,GAAQE,EAAI,SAAWF,GAC1CD,EAAY,KAAKG,CAAG,CACxB,CACF,CAEI,OAAAH,EAAY,OAAS,GACvBF,EAAc,MAAQE,EACf,GAAGA,EAAY,CAAC,EAAE,IAAI;AAAA,EAAKA,EAAY,CAAC,EAAE,IAAI,IAG9C,GAAGF,EAAc,MAAM,CAAC,EAAE,IAAI;AAAA,EAAKA,EAAc,MAAM,CAAC,EAAE,IAAI,EACvE,CACD,EAEDM,EAAU,IAAM,CACdV,EAAO,MAAQ,GACfD,EAAY,MAAQ,EAGpB,WAAW,IAAM,CACfY,EAAiBN,EAAW,KAAK,GAChC,GAAI,CAAA,CACR,EAED,SAASM,EAAiBN,EAAY,CAE9B,MAAAO,EAAS,SAAS,eAAe,UAAU,EAGjD,GAAIA,EAAQ,CAKJ,MAAAC,GAHiBD,EAAO,iBAAmBA,EAAO,cAAc,UAGxC,eAAe,aAAa,EAC1D,GAAI,CAACC,EAAQ,CACX,QAAQ,IAAI,UAAU,EACtB,MACF,CAIA,MAAMC,EAAYD,EAAO,mBAEfC,EAAA,SAAS,CAAC,EAAE,UAAYT,CAAA,MAIlC,QAAQ,IAAI,kBAAkB,CAElC,CASY,OAAAU,EAAA,IAAM,GAAM,CACdd,EAAA,MAAQ,CAACA,EAAQ,MACrBA,EAAQ,MACOU,EAAA;AAAA,EAAM,EAEvBA,EAAiBN,EAAW,KAAK,EAEnC,EAAE,eAAe,CAAA,CAClB,EACWU,EAAA,aAAe,GAAM,CAC/BhB,EAAY,MAAQK,EAAc,MAAM,CAAC,EAAE,UAC3C,EAAE,eAAe,CAAA,CAClB"}