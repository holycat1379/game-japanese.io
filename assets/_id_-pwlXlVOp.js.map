{"version":3,"file":"_id_-pwlXlVOp.js","sources":["../../src/pages/study/[id].vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { useMediaControls } from '@vueuse/core'\nimport { ref } from 'vue'\n\nconst route = useRoute()\n\nconst config = {\n  startIndex: 10,\n  endIndex: 30,\n}\nconst lessons = computed(() => {\n  return Array.from({ length: config.endIndex - config.startIndex + 1 }, (_, i) => {\n    return {\n      id: i + config.startIndex,\n      name: `第${i + config.startIndex}课`,\n      mp3: `/japanese/mina-no-nihongo/${i + config.startIndex}.mp3`,\n      vtt: `/japanese/mina-no-nihongo/${i + config.startIndex}.mp3.zh-CN-dual.vtt`,\n    }\n  })\n})\nconst currentLesson = reactive(lessons.value.find(lesson => lesson.id === Number(route.params.id)))\nconst video = ref()\nconst {\n  currentTime,\n  volume,\n  playing,\n  tracks,\n} = useMediaControls(video, {\n  src: currentLesson.mp3,\n  tracks: [\n    {\n      default: true,\n      src: currentLesson.vtt,\n      kind: 'subtitles',\n      label: 'English',\n      srcLang: 'en',\n    },\n  ],\n})\n\nconst preCurrentCue = reactive([])\n\nconst currentCues = computed(() => {\n  if (tracks.value[0] && tracks.value[0].cues) {\n    const cues = tracks.value[0].cues\n    const time = currentTime.value\n\n    for (const key in cues) {\n      const cue = cues[key]\n      if (cue.startTime <= time && cue.endTime >= time) {\n        preCurrentCue.splice(0, preCurrentCue.length)\n        cues[Number(key) - 3] && preCurrentCue.push(cues[Number(key) - 3])\n        cues[Number(key) - 2] && preCurrentCue.push(cues[Number(key) - 2])\n        cues[Number(key) - 1] && preCurrentCue.push(cues[Number(key) - 1])\n        preCurrentCue.push(cues[key])\n        cues[Number(key) + 1] && preCurrentCue.push(cues[Number(key) + 1])\n        break\n      }\n    }\n  }\n  return preCurrentCue\n})\n\nonMounted(() => {\n  volume.value = 0.5\n  currentTime.value = 0\n})\n\nonKeyStroke(' ', (e) => {\n  playing.value = !playing.value\n  e.preventDefault()\n})\nonKeyStroke('ArrowRight', (e) => {\n  currentTime.value = preCurrentCue.value[0].startTime\n  e.preventDefault()\n})\n</script>\n\n<template>\n  <div class=\"absolute top-36 h-96 w-full\">\n    <div v-show=\"!playing\">\n      <div v-for=\"(cue, index) in currentCues\" :key=\"index\" class=\"mb-5 cursor-pointer text-xs\" @click=\"currentTime = cue.startTime\">\n        <span :class=\"{ 'text-xs border-b border-light-50': index === currentCues.length - 2 }\">{{ cue.text }}</span>\n      </div>\n      <video ref=\"video\" class=\"hidden\" />\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.iframe {\n  width: 100vw;\n  height: 100vh;\n}\n</style>\n"],"names":["route","useRoute","config","lessons","computed","_","i","currentLesson","reactive","lesson","video","ref","currentTime","volume","playing","tracks","useMediaControls","preCurrentCue","currentCues","cues","time","key","cue","onMounted","onKeyStroke"],"mappings":"8PAIA,MAAMA,EAAQC,IAERC,EAAS,CACb,WAAY,GACZ,SAAU,EAAA,EAENC,EAAUC,EAAS,IAChB,MAAM,KAAK,CAAE,OAAQF,EAAO,SAAWA,EAAO,WAAa,CAAE,EAAG,CAACG,EAAGC,KAClE,CACL,GAAIA,EAAIJ,EAAO,WACf,KAAM,IAAII,EAAIJ,EAAO,UAAU,IAC/B,IAAK,6BAA6BI,EAAIJ,EAAO,UAAU,OACvD,IAAK,6BAA6BI,EAAIJ,EAAO,UAAU,qBAAA,EAE1D,CACF,EACKK,EAAgBC,EAASL,EAAQ,MAAM,KAAKM,GAAUA,EAAO,KAAO,OAAOT,EAAM,OAAO,EAAE,CAAC,CAAC,EAC5FU,EAAQC,IACR,CACJ,YAAAC,EACA,OAAAC,EACA,QAAAC,EACA,OAAAC,CAAA,EACEC,EAAiBN,EAAO,CAC1B,IAAKH,EAAc,IACnB,OAAQ,CACN,CACE,QAAS,GACT,IAAKA,EAAc,IACnB,KAAM,YACN,MAAO,UACP,QAAS,IACX,CACF,CAAA,CACD,EAEKU,EAAgBT,EAAS,CAAA,CAAE,EAE3BU,EAAcd,EAAS,IAAM,CAC7B,GAAAW,EAAO,MAAM,CAAC,GAAKA,EAAO,MAAM,CAAC,EAAE,KAAM,CAC3C,MAAMI,EAAOJ,EAAO,MAAM,CAAC,EAAE,KACvBK,EAAOR,EAAY,MAEzB,UAAWS,KAAOF,EAAM,CAChB,MAAAG,EAAMH,EAAKE,CAAG,EACpB,GAAIC,EAAI,WAAaF,GAAQE,EAAI,SAAWF,EAAM,CAClCH,EAAA,OAAO,EAAGA,EAAc,MAAM,EAC5CE,EAAK,OAAOE,CAAG,EAAI,CAAC,GAAKJ,EAAc,KAAKE,EAAK,OAAOE,CAAG,EAAI,CAAC,CAAC,EACjEF,EAAK,OAAOE,CAAG,EAAI,CAAC,GAAKJ,EAAc,KAAKE,EAAK,OAAOE,CAAG,EAAI,CAAC,CAAC,EACjEF,EAAK,OAAOE,CAAG,EAAI,CAAC,GAAKJ,EAAc,KAAKE,EAAK,OAAOE,CAAG,EAAI,CAAC,CAAC,EACnDJ,EAAA,KAAKE,EAAKE,CAAG,CAAC,EAC5BF,EAAK,OAAOE,CAAG,EAAI,CAAC,GAAKJ,EAAc,KAAKE,EAAK,OAAOE,CAAG,EAAI,CAAC,CAAC,EACjE,KACF,CACF,CACF,CACO,OAAAJ,CAAA,CACR,EAED,OAAAM,EAAU,IAAM,CACdV,EAAO,MAAQ,GACfD,EAAY,MAAQ,CAAA,CACrB,EAEWY,EAAA,IAAM,GAAM,CACdV,EAAA,MAAQ,CAACA,EAAQ,MACzB,EAAE,eAAe,CAAA,CAClB,EACWU,EAAA,aAAe,GAAM,CAC/BZ,EAAY,MAAQK,EAAc,MAAM,CAAC,EAAE,UAC3C,EAAE,eAAe,CAAA,CAClB"}