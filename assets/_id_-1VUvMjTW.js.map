{"version":3,"file":"_id_-1VUvMjTW.js","sources":["../../src/pages/study/[id].vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { useMediaControls } from '@vueuse/core'\nimport { ref } from 'vue'\n\nconst route = useRoute()\n\nconst config = {\n  startIndex: 10,\n  endIndex: 30,\n}\nconst lessons = computed(() => {\n  return Array.from({ length: config.endIndex - config.startIndex + 1 }, (_, i) => {\n    return {\n      id: i + config.startIndex,\n      name: `第${i + config.startIndex}课`,\n      mp3: `/game-japanese.io/japanese/mina-no-nihongo/${i + config.startIndex}.mp3`,\n      vtt: `/game-japanese.io/japanese/mina-no-nihongo/${i + config.startIndex}.mp3.zh-CN-dual.vtt`,\n    }\n  })\n})\nconst currentLesson = reactive(lessons.value.find(lesson => lesson.id === Number(route.params.id)))\nconst video = ref()\nconst {\n  duration,\n  currentTime,\n  volume,\n  playing,\n  tracks,\n} = useMediaControls(video, {\n  src: currentLesson.mp3,\n  tracks: [\n    {\n      default: true,\n      src: currentLesson.vtt,\n      kind: 'subtitles',\n      label: 'English',\n      srcLang: 'en',\n    },\n  ],\n})\n\nconst preCurrentCue = reactive([])\n\nconst currentCues = computed(() => {\n  if (tracks.value[0] && tracks.value[0].cues) {\n    const cues = tracks.value[0].cues\n    const time = currentTime.value\n\n    for (const key in cues) {\n      const cue = cues[key]\n      if (cue.startTime <= time && cue.endTime >= time) {\n        preCurrentCue.splice(0, preCurrentCue.length)\n        cues[Number(key) - 3] && preCurrentCue.push(cues[Number(key) - 3])\n        cues[Number(key) - 2] && preCurrentCue.push(cues[Number(key) - 2])\n        cues[Number(key) - 1] && preCurrentCue.push(cues[Number(key) - 1])\n        preCurrentCue.push(cues[key])\n        cues[Number(key) + 1] && preCurrentCue.push(cues[Number(key) + 1])\n        break\n      }\n    }\n  }\n  return preCurrentCue\n})\nconst lastCurrentTimes = useLocalStorage<Record<string, number>>('lastCurrentTime', {})\n\nonMounted(() => {\n  volume.value = 0.5\n  currentTime.value = 0\n  const last = lastCurrentTimes.value[currentLesson.id]\n  if (last)\n    currentTime.value = last\n  else\n    lastCurrentTimes.value[currentLesson.id] = 0\n})\n\nwatch(() => currentTime.value, () => {\n  lastCurrentTimes.value[currentLesson.id] = currentTime.value\n})\n\nonKeyStroke(' ', (e) => {\n  playing.value = !playing.value\n  e.preventDefault()\n})\nonKeyStroke('ArrowRight', (e) => {\n  currentTime.value = preCurrentCue.value[0].startTime\n  e.preventDefault()\n})\n\nconst isMobile = useLocalStorage('is-mobile', false)\n\nconst isShowSetting = ref(false)\n\nconst classList = computed(() => {\n  if (isMobile.value) {\n    return {\n      otherClass: 'mb-5 cursor-pointer text-xs',\n      currentClass: 'text-1xl border-b border-light-50',\n    }\n  }\n  else {\n    return {\n      otherClass: 'text-xs',\n      currentClass: 'border-b border-light-50',\n    }\n  }\n})\n</script>\n\n<template>\n  <div>\n    <div class=\"absolute h-96 w-full\">\n      <div v-show=\"!playing\">\n        <div v-for=\"(cue, index) in currentCues\" :key=\"index\" class=\"mb-5 cursor-pointer\" @click=\"currentTime = cue.startTime\">\n          <span v-if=\"index === currentCues.length - 2 \" :class=\"classList.currentClass\">{{ cue.text }}</span>\n          <span v-else :class=\"classList.otherClass\">{{ cue.text }}</span>\n        </div>\n        <video ref=\"video\" class=\"hidden\" />\n      </div>\n    </div>\n\n    <div v-if=\"isMobile\" class=\"absolute bottom-10 w-full flex justify-center\">\n      <button class=\"border border-light-100 p-4\" @click=\"playing = !playing\">\n        <div v-if=\"!playing\" i-carbon-arrow-right />\n        <div v-if=\"playing\" i-carbon-stop />\n      </button>\n    </div>\n\n    <div class=\"fixed bottom-0 right-15 w-full flex justify-right\">\n      <button @click=\"isShowSetting = !isShowSetting\">\n        <div i-carbon-settings />\n      </button>\n    </div>\n\n    <div v-if=\"isShowSetting\" class=\"absolute right-10 top-30 h-40 w-60 flex flex-col justify-right bg-dark-50 p-4\">\n      <input v-model=\"currentTime\" type=\"range\" name=\"range\" min=\"0\" :max=\"duration\">\n      <p>\n        Start/duration: {{ parseInt(currentTime / 60) }} / {{ parseInt(duration / 60) }}\n      </p>\n      <button class=\"mt-4 border border-light-50\" @click=\"isMobile = !isMobile\">\n        {{ isMobile ? 'mobile' : 'pc' }}\n      </button>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n.iframe {\n  width: 100vw;\n  height: 100vh;\n}\n</style>\n"],"names":["route","useRoute","config","lessons","computed","_","i","currentLesson","reactive","lesson","video","ref","duration","currentTime","volume","playing","tracks","useMediaControls","preCurrentCue","currentCues","cues","time","key","cue","lastCurrentTimes","useLocalStorage","onMounted","last","watch","onKeyStroke","isMobile","isShowSetting","classList"],"mappings":"yqBAIA,MAAMA,EAAQC,IAERC,EAAS,CACb,WAAY,GACZ,SAAU,EAAA,EAENC,EAAUC,EAAS,IAChB,MAAM,KAAK,CAAE,OAAQF,EAAO,SAAWA,EAAO,WAAa,CAAE,EAAG,CAACG,EAAGC,KAClE,CACL,GAAIA,EAAIJ,EAAO,WACf,KAAM,IAAII,EAAIJ,EAAO,UAAU,IAC/B,IAAK,8CAA8CI,EAAIJ,EAAO,UAAU,OACxE,IAAK,8CAA8CI,EAAIJ,EAAO,UAAU,qBAAA,EAE3E,CACF,EACKK,EAAgBC,EAASL,EAAQ,MAAM,KAAKM,GAAUA,EAAO,KAAO,OAAOT,EAAM,OAAO,EAAE,CAAC,CAAC,EAC5FU,EAAQC,IACR,CACJ,SAAAC,EACA,YAAAC,EACA,OAAAC,EACA,QAAAC,EACA,OAAAC,CAAA,EACEC,EAAiBP,EAAO,CAC1B,IAAKH,EAAc,IACnB,OAAQ,CACN,CACE,QAAS,GACT,IAAKA,EAAc,IACnB,KAAM,YACN,MAAO,UACP,QAAS,IACX,CACF,CAAA,CACD,EAEKW,EAAgBV,EAAS,CAAA,CAAE,EAE3BW,EAAcf,EAAS,IAAM,CAC7B,GAAAY,EAAO,MAAM,CAAC,GAAKA,EAAO,MAAM,CAAC,EAAE,KAAM,CAC3C,MAAMI,EAAOJ,EAAO,MAAM,CAAC,EAAE,KACvBK,EAAOR,EAAY,MAEzB,UAAWS,KAAOF,EAAM,CAChB,MAAAG,EAAMH,EAAKE,CAAG,EACpB,GAAIC,EAAI,WAAaF,GAAQE,EAAI,SAAWF,EAAM,CAClCH,EAAA,OAAO,EAAGA,EAAc,MAAM,EAC5CE,EAAK,OAAOE,CAAG,EAAI,CAAC,GAAKJ,EAAc,KAAKE,EAAK,OAAOE,CAAG,EAAI,CAAC,CAAC,EACjEF,EAAK,OAAOE,CAAG,EAAI,CAAC,GAAKJ,EAAc,KAAKE,EAAK,OAAOE,CAAG,EAAI,CAAC,CAAC,EACjEF,EAAK,OAAOE,CAAG,EAAI,CAAC,GAAKJ,EAAc,KAAKE,EAAK,OAAOE,CAAG,EAAI,CAAC,CAAC,EACnDJ,EAAA,KAAKE,EAAKE,CAAG,CAAC,EAC5BF,EAAK,OAAOE,CAAG,EAAI,CAAC,GAAKJ,EAAc,KAAKE,EAAK,OAAOE,CAAG,EAAI,CAAC,CAAC,EACjE,KACF,CACF,CACF,CACO,OAAAJ,CAAA,CACR,EACKM,EAAmBC,EAAwC,kBAAmB,CAAE,CAAA,EAEtFC,EAAU,IAAM,CACdZ,EAAO,MAAQ,GACfD,EAAY,MAAQ,EACpB,MAAMc,EAAOH,EAAiB,MAAMjB,EAAc,EAAE,EAChDoB,EACFd,EAAY,MAAQc,EAEHH,EAAA,MAAMjB,EAAc,EAAE,EAAI,CAAA,CAC9C,EAEKqB,EAAA,IAAMf,EAAY,MAAO,IAAM,CACnCW,EAAiB,MAAMjB,EAAc,EAAE,EAAIM,EAAY,KAAA,CACxD,EAEWgB,EAAA,IAAM,GAAM,CACdd,EAAA,MAAQ,CAACA,EAAQ,MACzB,EAAE,eAAe,CAAA,CAClB,EACWc,EAAA,aAAe,GAAM,CAC/BhB,EAAY,MAAQK,EAAc,MAAM,CAAC,EAAE,UAC3C,EAAE,eAAe,CAAA,CAClB,EAEK,MAAAY,EAAWL,EAAgB,YAAa,EAAK,EAE7CM,EAAgBpB,EAAI,EAAK,EAEzBqB,EAAY5B,EAAS,IACrB0B,EAAS,MACJ,CACL,WAAY,8BACZ,aAAc,mCAAA,EAIT,CACL,WAAY,UACZ,aAAc,0BAAA,CAGnB"}